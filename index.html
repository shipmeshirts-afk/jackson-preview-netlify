<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Design Prompt Previewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-900 p-6">
  <div class="max-w-4xl mx-auto space-y-6">
    <h1 class="text-3xl font-bold">Design Prompt Previewer</h1>

    <label class="flex items-center space-x-2">
      <input id="demoMode" type="checkbox" class="h-4 w-4" />
      <span>Demo mode (no backend)</span>
    </label>

    <textarea id="prompt" class="w-full p-3 rounded border" rows="3"
      placeholder="Enter design prompt..."></textarea>

    <div class="grid grid-cols-3 gap-3">
      <select id="style" class="p-3 border rounded">
        <option>Clean vector logo</option>
        <option>Bold mascot logo</option>
        <option>Realistic patch engraving</option>
      </select>

      <select id="size" class="p-3 border rounded">
        <option>1024x1024</option>
        <option>512x512</option>
        <option>2048x2048</option>
      </select>

      <input id="seed" class="p-3 border rounded" placeholder="Seed (optional)" />
    </div>

    <button id="go" class="px-6 py-3 bg-black text-white rounded hover:bg-gray-800">
      Generate
    </button>

    <div class="border bg-white rounded h-[500px] flex items-center justify-center">
      <img id="preview" class="max-h-full max-w-full" alt="Preview" referrerpolicy="no-referrer" />
    </div>

    <p id="openWrap" class="text-xs text-center mt-2 hidden">
      <a id="openLink" class="underline text-blue-700" target="_blank" rel="noreferrer">Open image in a new tab</a>
    </p>
  </div>

<script>
const img = document.getElementById('preview');
const openWrap = document.getElementById('openWrap');
const openLink = document.getElementById('openLink');

function showLink(url){ 
  if(!url){openWrap.classList.add('hidden');return}
  openLink.href = url; 
  openWrap.classList.remove('hidden'); 
}

document.getElementById('go').addEventListener('click', async () => {
  const prompt = document.getElementById('prompt').value.trim();
  const style = document.getElementById('style').value;
  const size = document.getElementById('size').value;
  const seed = document.getElementById('seed').value.trim();
  const demo = document.getElementById('demoMode').checked;

  if(!prompt){ alert('Enter a prompt first'); return; }

  img.src = ''; showLink('');

  if(demo){
    img.src = `https://source.unsplash.com/${size}/?${encodeURIComponent(prompt)}`;
    showLink(img.src);
    return;
  }

  try{
    const qs = new URLSearchParams({ prompt, style, size, seed }).toString();
    const res = await fetch(`/.netlify/functions/generate?${qs}`);
    const data = await res.json();

    img.src = data.url || data.fallback || '';
    showLink(img.src);
  }catch(e){
    alert("Backend unavailable - switch on Demo Mode.");
  }
});
</script>

</body>
</html>
